<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>bar.mjs - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BarChart.html">BarChart</a><ul class='methods'><li data-type='method' style='display: none;'><a href="BarChart.html#init">init</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#addGradient">addGradient</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#removeGradient">removeGradient</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#adjustSize">adjustSize</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#setElement">setElement</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#beforeSetElement">beforeSetElement</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#afterSetElement">afterSetElement</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#getColor">getColor</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#isParentChart">isParentChart</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#addChart">addChart</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#getAllCharts">getAllCharts</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#onTooltip">onTooltip</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#onAxisLabel">onAxisLabel</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#hideTooltip">hideTooltip</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#showTooltip">showTooltip</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#suspendTooltip">suspendTooltip</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#resumeTooltip">resumeTooltip</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#isTooltipAvailable">isTooltipAvailable</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#isTooltipPointing">isTooltipPointing</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#setTooltipPosition">setTooltipPosition</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#updateVisibleTooltip">updateVisibleTooltip</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#findNearestFromXCoord">findNearestFromXCoord</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#setZoom">setZoom</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#setData">setData</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#normalizeData">normalizeData</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#render">render</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#beforeRender">beforeRender</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#adjustScale">adjustScale</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#doLayout">doLayout</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#afterRender">afterRender</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#xValueScale">xValueScale</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#yValueScale">yValueScale</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#xValueToCoord">xValueToCoord</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#yValueToCoord">yValueToCoord</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#xCoordScale">xCoordScale</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#yCoordScale">yCoordScale</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#xCoordToValue">xCoordToValue</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#yCoordToValue">yCoordToValue</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#reset">reset</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#doReset">doReset</a></li><li data-type='method' style='display: none;'><a href="BarChart.html#makePath">makePath</a></li></ul></li><li><a href="Color.html">Color</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Color.html#.fromRGB">fromRGB</a></li><li data-type='method' style='display: none;'><a href="Color.html#.fromHex">fromHex</a></li><li data-type='method' style='display: none;'><a href="Color.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="Color.html#hue">hue</a></li><li data-type='method' style='display: none;'><a href="Color.html#saturation">saturation</a></li><li data-type='method' style='display: none;'><a href="Color.html#light">light</a></li><li data-type='method' style='display: none;'><a href="Color.html#alpha">alpha</a></li><li data-type='method' style='display: none;'><a href="Color.html#adjustHue">adjustHue</a></li><li data-type='method' style='display: none;'><a href="Color.html#adjustLight">adjustLight</a></li><li data-type='method' style='display: none;'><a href="Color.html#adjustSaturation">adjustSaturation</a></li><li data-type='method' style='display: none;'><a href="Color.html#adjustAlpha">adjustAlpha</a></li><li data-type='method' style='display: none;'><a href="Color.html#toString">toString</a></li></ul></li><li><a href="Gradient.html">Gradient</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Gradient.html#.fromObject">fromObject</a></li><li data-type='method' style='display: none;'><a href="Gradient.html#addColor">addColor</a></li></ul></li><li><a href="LinearGradient.html">LinearGradient</a><ul class='methods'><li data-type='method' style='display: none;'><a href="LinearGradient.html#addColor">addColor</a></li></ul></li><li><a href="Chart.html">Chart</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Chart.html#init">init</a></li><li data-type='method' style='display: none;'><a href="Chart.html#addGradient">addGradient</a></li><li data-type='method' style='display: none;'><a href="Chart.html#removeGradient">removeGradient</a></li><li data-type='method' style='display: none;'><a href="Chart.html#adjustSize">adjustSize</a></li><li data-type='method' style='display: none;'><a href="Chart.html#setElement">setElement</a></li><li data-type='method' style='display: none;'><a href="Chart.html#beforeSetElement">beforeSetElement</a></li><li data-type='method' style='display: none;'><a href="Chart.html#afterSetElement">afterSetElement</a></li><li data-type='method' style='display: none;'><a href="Chart.html#getColor">getColor</a></li><li data-type='method' style='display: none;'><a href="Chart.html#isParentChart">isParentChart</a></li><li data-type='method' style='display: none;'><a href="Chart.html#addChart">addChart</a></li><li data-type='method' style='display: none;'><a href="Chart.html#getAllCharts">getAllCharts</a></li><li data-type='method' style='display: none;'><a href="Chart.html#onTooltip">onTooltip</a></li><li data-type='method' style='display: none;'><a href="Chart.html#onAxisLabel">onAxisLabel</a></li><li data-type='method' style='display: none;'><a href="Chart.html#hideTooltip">hideTooltip</a></li><li data-type='method' style='display: none;'><a href="Chart.html#showTooltip">showTooltip</a></li><li data-type='method' style='display: none;'><a href="Chart.html#suspendTooltip">suspendTooltip</a></li><li data-type='method' style='display: none;'><a href="Chart.html#resumeTooltip">resumeTooltip</a></li><li data-type='method' style='display: none;'><a href="Chart.html#isTooltipAvailable">isTooltipAvailable</a></li><li data-type='method' style='display: none;'><a href="Chart.html#isTooltipPointing">isTooltipPointing</a></li><li data-type='method' style='display: none;'><a href="Chart.html#setTooltipPosition">setTooltipPosition</a></li><li data-type='method' style='display: none;'><a href="Chart.html#updateVisibleTooltip">updateVisibleTooltip</a></li><li data-type='method' style='display: none;'><a href="Chart.html#findNearestFromXCoord">findNearestFromXCoord</a></li><li data-type='method' style='display: none;'><a href="Chart.html#setZoom">setZoom</a></li><li data-type='method' style='display: none;'><a href="Chart.html#setData">setData</a></li><li data-type='method' style='display: none;'><a href="Chart.html#normalizeData">normalizeData</a></li><li data-type='method' style='display: none;'><a href="Chart.html#render">render</a></li><li data-type='method' style='display: none;'><a href="Chart.html#beforeRender">beforeRender</a></li><li data-type='method' style='display: none;'><a href="Chart.html#adjustScale">adjustScale</a></li><li data-type='method' style='display: none;'><a href="Chart.html#doLayout">doLayout</a></li><li data-type='method' style='display: none;'><a href="Chart.html#afterRender">afterRender</a></li><li data-type='method' style='display: none;'><a href="Chart.html#xValueScale">xValueScale</a></li><li data-type='method' style='display: none;'><a href="Chart.html#yValueScale">yValueScale</a></li><li data-type='method' style='display: none;'><a href="Chart.html#xValueToCoord">xValueToCoord</a></li><li data-type='method' style='display: none;'><a href="Chart.html#yValueToCoord">yValueToCoord</a></li><li data-type='method' style='display: none;'><a href="Chart.html#xCoordScale">xCoordScale</a></li><li data-type='method' style='display: none;'><a href="Chart.html#yCoordScale">yCoordScale</a></li><li data-type='method' style='display: none;'><a href="Chart.html#xCoordToValue">xCoordToValue</a></li><li data-type='method' style='display: none;'><a href="Chart.html#yCoordToValue">yCoordToValue</a></li><li data-type='method' style='display: none;'><a href="Chart.html#reset">reset</a></li><li data-type='method' style='display: none;'><a href="Chart.html#doReset">doReset</a></li><li data-type='method' style='display: none;'><a href="Chart.html#makePath">makePath</a></li></ul></li><li><a href="LineChart.html">LineChart</a><ul class='methods'><li data-type='method' style='display: none;'><a href="LineChart.html#setSegments">setSegments</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#showBrush">showBrush</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#hideBrush">hideBrush</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#setBrush">setBrush</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#init">init</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#addGradient">addGradient</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#removeGradient">removeGradient</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#adjustSize">adjustSize</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#setElement">setElement</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#beforeSetElement">beforeSetElement</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#afterSetElement">afterSetElement</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#getColor">getColor</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#isParentChart">isParentChart</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#addChart">addChart</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#getAllCharts">getAllCharts</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#onTooltip">onTooltip</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#onAxisLabel">onAxisLabel</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#hideTooltip">hideTooltip</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#showTooltip">showTooltip</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#suspendTooltip">suspendTooltip</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#resumeTooltip">resumeTooltip</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#isTooltipAvailable">isTooltipAvailable</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#isTooltipPointing">isTooltipPointing</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#setTooltipPosition">setTooltipPosition</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#updateVisibleTooltip">updateVisibleTooltip</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#findNearestFromXCoord">findNearestFromXCoord</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#setZoom">setZoom</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#setData">setData</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#normalizeData">normalizeData</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#render">render</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#beforeRender">beforeRender</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#adjustScale">adjustScale</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#doLayout">doLayout</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#afterRender">afterRender</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#xValueScale">xValueScale</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#yValueScale">yValueScale</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#xValueToCoord">xValueToCoord</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#yValueToCoord">yValueToCoord</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#xCoordScale">xCoordScale</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#yCoordScale">yCoordScale</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#xCoordToValue">xCoordToValue</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#yCoordToValue">yCoordToValue</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#reset">reset</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#doReset">doReset</a></li><li data-type='method' style='display: none;'><a href="LineChart.html#makePath">makePath</a></li></ul></li></ul><h3>Externals</h3><ul><li><a href="external-CSS_Color.html">CSS_Color</a></li><li><a href="external-EventTarget.html">EventTarget</a></li><li><a href="external-Element.html">Element</a></li></ul><h3>Events</h3><ul><li><a href="Chart.html#event:tooltip">tooltip</a></li><li><a href="Chart.html#event:zoom">zoom</a></li><li><a href="LineChart.html#event:brush">brush</a></li><li><a href="BarChart.html#event:tooltip">tooltip</a></li><li><a href="BarChart.html#event:zoom">zoom</a></li><li><a href="LineChart.html#event:tooltip">tooltip</a></li><li><a href="LineChart.html#event:zoom">zoom</a></li></ul><h3>Global</h3><ul><li><a href="global.html#parse">parse</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">bar.mjs</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as common from './common.mjs';
import * as colorMod from './color.mjs';


/**
 * @typedef {object} BarChartOptions
 * @property {number} [barSpacing=6]
 * @property {number} [barRadius=4]
 */


/**
 * @extends Chart
 * @param {BarChartOptions|ChartOptions} [options]
 */
export class BarChart extends common.Chart {

    init(options={}) {
        this.barSpacing = options.barSpacing ?? 6;
        this.barRadius = options.barRadius ?? 4;
        this._bars = new Map();
        this._barsPendingRemoval = new Map();
        this._barFills = new Map();
    }

    beforeSetElement(el) {
        el.classList.add('sc-barchart');
    }

    afterSetElement(el) {
        const barsClipId = `bars-clip-${this.id}`;
        const defs = common.createSVG({
            name: 'defs',
            children: [{
                name: 'clipPath',
                id: barsClipId,
                children: [{
                    name: 'rect',
                    class: ['sc-bars-clip']
                }]
            }]
        });
        this._barsEl = common.createSVG({
            name: 'g',
            class: 'sc-bars',
            attrs: {
                'clip-path': `url(#${barsClipId})`,
            }
        });
        this._plotRegionEl.replaceChildren(defs, this._barsEl);
    }

    doReset() {
        this._barsEl.replaceChildren();
        this._bars.clear();
        this._barsPendingRemoval.clear();
        for (const x of this._barFills.values()) {
            this.removeGradient(x.gradient);
        }
        this._barFills.clear();
    }

    doLayout(manifest, options) {
        this._renderDoLayout(this._renderBeforeLayout(manifest, options), options);
        this._schedGC();
    }

    normalizeData(data) {
        // Convert to width and height to center-x and top-y..
        const norm = new Array(data.length);
        if (!data.length) {
            return norm;
        }
        if (Array.isArray(data[0])) {
            // [[width, y], [width, y], ...]
            const width = data[0][0] || 0;
            norm[0] = {index: 0, width, x: width / 2, y: data[0][1] || 0, ref: data[0]};
            let offt = width;
            for (let i = 1; i &lt; data.length; i++) {
                const o = data[i];
                const width = o[0] || 0;
                offt += width;
                norm[i] = {index: i, width, x: offt - (width / 2), y: o[1] || 0, ref: o};
            }
        } else if (typeof data[0] === 'object' &amp;&amp; Object.getPrototypeOf(data[0]) === Object.prototype) {
            // [{width, y, ...}, {width, y, ...}, ...]
            const width = data[0].width || 0;
            norm[0] = {...data[0], index: 0, width, x: width / 2, y: data[0].y || 0, ref: data[0]};
            let offt = width;
            for (let i = 1; i &lt; data.length; i++) {
                const o = data[i];
                const width = o.width || 0;
                offt += width;
                norm[i] = {...o, index: i, width, x: offt - (width / 2), y: o.y || 0, ref: o};
            }
        } else {
            // [y, y1, ...]
            let convWarn = 0;
            for (let i = 0; i &lt; data.length; i++) {
                // Importantly, we need unique objects for the data ref and not primatives..
                // Option 1: do not allow this, throw TypeError
                // Option 2: alter the users data (they did give it to us)
                let y;
                if (typeof data[i] === 'number') {
                    convWarn++;
                    y = data[i];
                    data[i] = new Number(y);
                } else {
                    y = +data[i];
                }
                norm[i] = {index: i, width: 1, x: i + 0.5, y: y || 0, ref: data[i]};
            }
            if (convWarn) {
                console.warn(`Converted ${convWarn} primative numbers to unique objects.`);
            }
        }
        return norm;
    }

    adjustScale(manifest) {
        super.adjustScale(manifest);
        if (this._yMax === this._yMin) {
            this._yMin -= 1;
        }
        if (this.xMin == null) {
            this._xMin = 0;
        }
        if (this.xMax == null) {
            this._xMax = manifest.data.reduce((agg, x) => agg + x.width, 0);
        }
    }

    _renderBeforeLayout({data, resampling}, options={}) {
        const unclaimed = new Map(this._bars);
        const layout = {
            add: [],
            remove: [],
            update: [],
        };
        const yMinCoord = this.yValueToCoord(Math.max(0, this._yMin));
        const adding = [];
        for (let index = 0; index &lt; data.length; index++) {
            const entry = data[index];
            const x1 = this.xValueToCoord(entry.x - entry.width / 2);
            const x2 = this.xValueToCoord(entry.x + entry.width / 2);
            const y = this.yValueToCoord(entry.y);
            const height = yMinCoord - y;
            const color = entry.color || this.getColor();
            const fillKey = `${color}-${height &lt; 0 ? 'down' : 'up'}`;
            let barFill = this._barFills.get(fillKey);
            if (!barFill) {
                const fill = colorMod.parse(color);
                const gradient = this.addGradient((fill instanceof colorMod.Gradient) ? fill : {
                    rotate: height &lt; 0 ? 180 : 0,
                    type: 'linear',
                    colors: [
                        fill.adjustAlpha(-0.5).adjustLight(-0.2),
                        fill.adjustAlpha(-0.14),
                    ]
                });
                this._barFills.set(fillKey, barFill = {gradient});
            }
            const attrs = {
                width: x2 - x1,
                height,
                x: x1,
                y,
                fill: `url(#${barFill.gradient.id})`,
            };
            let bar = this._bars.get(entry.ref);
            if (!bar) {
                bar = this._barsPendingRemoval.get(entry.ref);
                if (bar) {
                    bar.sig = null;
                    this._barsPendingRemoval.delete(entry.ref);
                    this._bars.set(entry.ref, bar);
                }
            } else {
                unclaimed.delete(entry.ref);
            }
            if (!bar) {
                bar = {};
                adding.push({bar, ref: entry.ref});
            }
            const sig = `${attrs.width} ${attrs.height} ${attrs.x} ${attrs.y} ${attrs.fill}`;
            if (bar.sig !== sig) {
                bar.sig = sig;
                bar.attrs = attrs;
                bar.fillKey = fillKey;
                if (bar.el) {
                    layout.update.push(bar);
                }
            }
        }
        let unclaimedIter = adding.length &amp;&amp; resampling &amp;&amp; unclaimed.size &amp;&amp; unclaimed.entries();
        for (let i = 0; i &lt; adding.length; i++) {
            const {bar, ref} = adding[i];
            if (resampling) {
                if (unclaimedIter) {
                    const next = unclaimedIter.next().value;
                    if (next) {
                        const [oldKey, replace] = next;
                        unclaimed.delete(oldKey);
                        this._bars.delete(oldKey);
                        Object.assign(replace, bar);
                        this._bars.set(ref, replace);
                        layout.update.push(replace);
                        continue;
                    } else {
                        unclaimedIter = null;
                    }
                }
                if (this._barsPendingRemoval.size) {
                    const [oldKey, replace] = this._barsPendingRemoval.entries().next().value;
                    this._barsPendingRemoval.delete(oldKey);
                    Object.assign(replace, bar);
                    this._bars.set(ref, replace);
                    layout.update.push(replace);
                    continue;
                }
            }
            bar.el = common.createSVG({name: 'path', class: ['sc-bar', 'sc-visual-data-bar']});
            this._bars.set(ref, bar);
            layout.add.push(bar);
            layout.update.push(bar);
        }
        for (const [key, bar] of unclaimed) {
            bar.lastUsed = document.timeline.currentTime;
            this._bars.delete(key);
            this._barsPendingRemoval.set(key, bar);
            layout.remove.push(bar);
        }
        if (options.disableAnimation) {
            // Terminate any active animations from previously removed bars (test case: aggressive resizing)
            for (const bar of this._barsPendingRemoval.values()) {
                layout.remove.push(bar);
            }
        }
        return layout;
    }

    _renderDoLayout(layout, {disableAnimation}={}) {
        const plotQuarterX = this._plotWidth / 4 + this._plotBox[3];
        const baselineY = this.yValueToCoord(Math.max(0, this._yMin));
        const leftX = this.xValueToCoord(this._xMin);
        const rightX = this.xValueToCoord(this._xMax);
        for (let i = 0; i &lt; layout.add.length; i++) {
            const {el, attrs} = layout.add[i];
            if (!disableAnimation) {
                const centerX = attrs.x + attrs.width / 2;
                const x = centerX &lt; plotQuarterX ? leftX : centerX > plotQuarterX * 3 ? rightX : centerX;
                el.setAttribute('d', this._makeBarPath(x, baselineY, 0, 0));
            }
            this._barsEl.append(el);
        }
        if ((!disableAnimation &amp;&amp; layout.add.length) || disableAnimation) {
            this._rootSvgEl.clientWidth;
        }
        for (let i = 0; i &lt; layout.update.length; i++) {
            const {el, attrs} = layout.update[i];
            const width = Math.max(0, attrs.width - this.barSpacing);
            const x = attrs.x + this.barSpacing / 2;
            el.setAttribute('d', this._makeBarPath(x, attrs.y, width, attrs.height));
            el.setAttribute('fill', attrs.fill);
        }
        for (let i = 0; i &lt; layout.remove.length; i++) {
            const {attrs, el} = layout.remove[i];
            if (!disableAnimation) {
                const centerX = attrs.x + attrs.width / 2;
                const x = centerX &lt; plotQuarterX ? leftX : centerX > plotQuarterX * 3 ? rightX : centerX;
                el.setAttribute('d', this._makeBarPath(x, baselineY, 0, 0));
            } else {
                el.removeAttribute('d');
            }
        }
    }

    _makeBarPath(x, y, width, height) {
        const radius = Math.min(this.barRadius, width * 0.5, Math.abs(height));
        const rCtrl = height &lt; 0 ? -radius : radius;
        return (
            `M ${x},${y + height} ` +
            `v ${-height + rCtrl} ` +
            `q 0,${-rCtrl} ${radius},${-rCtrl} ` +
            `h ${width - (2 * radius)} ` +
            `q ${radius},0 ${radius},${rCtrl} ` +
            `v ${height - rCtrl} Z`
        );
    }

    _schedGC() {
        if (this._gcTimeout) {
            return;
        }
        this._gcTimeout = setTimeout(() => {
            common.requestIdle(() => {
                this._gcTimeout = null;
                this._gc();
            });
        }, 1100);
    }

    _gc() {
        const animDur = common.getStyleValue(this.el, '--transition-duration', 'time') || 100;
        const unclaimedFills = new Set(this._barFills.keys());
        for (const x of this._bars.values()) {
            unclaimedFills.delete(x.fillKey);
        }
        const expiration = document.timeline.currentTime - animDur - 100;
        let more;
        for (const [key, bar] of this._barsPendingRemoval) {
            if (bar.lastUsed > expiration) {
                more = true;
                unclaimedFills.delete(bar.fillKey);
            } else {
                this._barsPendingRemoval.delete(key);
                bar.el.remove();
                bar.el = null;
            }
        }
        for (const x of unclaimedFills) {
            const {gradient} = this._barFills.get(x);
            this.removeGradient(gradient);
            this._barFills.delete(x);
        }
        if (more) {
            this._schedGC();
        }
    }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>

<link type="text/css" rel="stylesheet" href="../../css/jsdoc-overrides.css"/>
<script src="../../js/jsdoc-overrides.js"></script>
